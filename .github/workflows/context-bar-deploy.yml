name: Context Bar Infra Rollout

on:
  workflow_dispatch:
  push:
    branches:
      - main
    paths:
      - 'bar/**'

jobs:
  create-local-files:
    name: Deploy to dev
    runs-on: ubuntu-20.04
    steps:
      - name: Cache local files
        id: local-file-cache
        uses: actions/cache@v2
        with:
          key: local-files
          path: files

      - name: create files
        if: steps.local-file-cache.outputs.cache-hit != 'true'
        run: mkdir ./files && echo "hello world" >> ./files/file-from-script.pem

  call-terraform-deploy:
    name: Call the _terraform-deploy re-usable workflow
    needs: create-local-files
    uses: andiMenge/actions-explo/.github/workflows/_terraform-deploy.yml@main
    with:
      certPath: "./files/file-from-script.pem"
